<!DOCTYPE html>
<html lang="en">

	<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
    <title>World of Warships Overpenetration Calculator</title>
	</head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155844497-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-155844497-1');
	</script>

	<body>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js'></script>

		<center><h1>World of Warships Overpenetration Calculator</h1></center>
		<button id=impactChartToggle class="btn btn-primary-outline btn-lg btn-block" data-toggle="collapse" data-target="#descriptions">Description</button>
		<div class="collapse" id=descriptions style="width: 100%;">
			<p>&nbsp;Overpen calculations are experimental - further testing may be needed to confirm results.</p>
			<p>&nbsp;Site will be updated if and when more accurate information becomes available.</p>
		</div>
		<style>
			table{
                border: 15px solid lightgray;
                background-color: lightgray;
            }
            td{
                border: 5px solid lightgray;
                background-color: lightgray;
            }
            tr {
			    border: 5px solid lightgray;
                background-color: lightgray;
			}

            th{
                border: 15px solid lightgray;
                background-color: lightgray;
            }
            canvas{
                background-color: white;
            }
			.collapsible {
				background-color: #777;
				color: white;
				cursor: pointer;
				padding: 18px;
				width: 100%;
				border: none;
				text-align: left;
				outline: none;
				font-size: 15px;
			}

			.btn btn-info {
				background-color: #777;
				color: white;
				cursor: pointer;
				padding: 18px;
				width: 100%;
				border: none;
				text-align: left;
				outline: none;
				font-size: 15px;
			}

			.active, .collapsible:hover {
				background-color: #555;
			}

		</style>
		
		<button id=impactChartToggle class="btn btn-primary-outline btn-lg btn-block" data-toggle="collapse" data-target="#parameters">Parameters</button>
		<div class="collapse" id=parameters style="width: 100%; background-color: lightgray;" >
		<table id=parameterTable style="width: 100%;">
			<tr>
				<th>
					<center><h2><u>Predefined Shells</u></h2></center>
				</th>
				<th>
					<center><h2><u>Shell Data</u></h2></center>
				</th>
				<th>
					<center><h2><u>Target Data</u></h2></center>
				</th>
				<th>
					<center><h2><u>Horizontal Angles</u></h2></center>
				</th>
			</tr>
			<tr>
				<td>
					<table>
						<tr><center><td>Ship A:</td></center></tr>
						<tr>
							<td>Version</td>
							<td><select id=version0 class="form-control" onchange="onChangeVersion('version0')"></select></td>
						</tr>
						<tr>
							<td>Nation</td>
							<td><select id=nation0 class="form-control" onchange="onChangeNation('nation0')"></select></td>
						</tr>
						<tr>
							<td>Type</td>
							<td><select id=type0 class="form-control" onchange="onChangeType('type0')"></select></td>
						</tr>
						<tr>
							<td>Ship</td>
							<td><select id=ship0 class="form-control" onchange="onChangeShip('ship0')"></select></td>
						</tr>
						<tr>
							<td>Artillery</td>
							<td><select id=shell0 class="form-control"  onchange="onChangeShell('shell0')"></select></td>
						</tr>
						<tr>
							<td>Shell Type</td>
							<td><select id=shellType0 class="form-control" onchange="onChangeShellType('shellType0')"></select></td>
						</tr>
						<tr>
							<td>Label</td>
							<td><input id="shipName0" class="form-control" value=""></td>
						</tr>

						<tr><center><td>Ship B:</td></center></tr>
						<tr>
							<td>Version</td>
							<td><select id=version1   class="form-control" onchange="onChangeVersion('version1')"></select></td>
						</tr>
						<tr>
							<td>Nation</td>
							<td><select id=nation1    class="form-control" onchange="onChangeNation('nation1')"></select></td>
						</tr>
						<tr>
							<td>Type</td>
							<td><select id=type1      class="form-control"   onchange="onChangeType('type1')"></select></td>
						</tr>
						<tr>
							<td>Ship</td>
							<td><select id=ship1      class="form-control"   onchange="onChangeShip('ship1')"></select></td>
						</tr>
						<tr>
							<td>Artillery</td>
							<td><select id=shell1     class="form-control"  onchange="onChangeShell('shell1')"></select></td>
						</tr>
						<tr>
							<td>Shell Type</td>
							<td><select id=shellType1 class="form-control"  onchange="onChangeShellType('shellType1')"></select></td>
						</tr>
						<tr>
							<td>Label</td>
							<td><input class="form-control" id="shipName1" value=""></td>
						</tr>
					</table>
					<!--<button onclick="onSubmitPredefined()">Apply</button>-->
				</td>
				<td>
					<table>
						<tr>
							<td></td>
							<td>Ship A:</td>
							<td>Ship B:</td>
						</tr>
						<tr>
							<td title="Diameter of the shell in meters. All else equal, higher caliber increase shell flight time and reduces penetration.">Caliber (m)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="caliber0"   value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="caliber1"   value=""></td>
						</tr>
						<tr>
							<td title="Shell velocity at launch in meters per second. All else equal, higher muzzle velocity reduces shell flight time and increase penetration.">Muzzle Velocity (m/s)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="mv0"        value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="mv1"        value=""></td>
						</tr>
						<tr>
							<td title="Aerodynamic drag characteristic of the shell's shape. All else equal, higher drag coefficient increase shell flight time and reduces penetration.">Drag Coefficient</td>
							<td><input class="form-control" type="number" step="any" min="0" id="cD0"        value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="cD1"        value=""></td>
						</tr>
						<tr>
							<td title="Mass of the shell in kilograms. All else equal, higher mass decreases shell flight time and increases penetration.">Mass (kg)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="mass0"      value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="mass1"      value=""></td>
						</tr>
						<tr>
							<td title="Penetration coefficient of the shell. All else equal, higher krupp increases penetration.">Krupp</td>
							<td><input class="form-control" type="number" step="any" min="0" id="krupp0"     value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="krupp1"     value=""></td>
						</tr>
						<tr>
							<td title="How many seconds it takes for the shell to detonate after fusing. Longer fusetime increases risk of overpenetration.">Fusetime (s)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="fusetime0"  value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="fusetime1"  value=""></td>
						</tr>
						<tr>
							<td title="How many milimeters of effective armor it takes for the shells arm. Higher fusing threshold increases the risk of overpenetration.">Fusing Threshold (mm)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="threshold0" value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="threshold1" value=""></td>
						</tr>
						<tr>
							<td title="How many degrees of impact angle the shell can reduce. Higher normalization increases decreases effective armor thickness.">Normalization (°)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="normal0"    value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="normal1"    value=""></td>
						</tr>
						<tr>
							<td title="Minimum impact angle in degrees at which shells can ricochet - not affected by normalization.">Start Ricochet (°)</td>
							<td><input class="form-control" type="number" step="any" min="0" max="90" id="ra0_0"  value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" max="90" id="ra0_1"  value=""></td>
						</tr>
						<tr>
							<td title="Minimum impact angle in degrees at which shells always ricochet - not affected by normalization.">Always Ricochet (°)</td>
							<td><input class="form-control" type="number" step="any" min="0" max="90" id="ra1_0"  value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" max="90" id="ra1_1"  value=""></td>
						</tr>
						<tr>
							<td title="HE/SAP penetration of shell - if applicable.">HE/SAP penetration (mm)</td>
							<td><input class="form-control" type="number" step="any" min="0" id="HESAP0" value=""></td>
							<td><input class="form-control" type="number" step="any" min="0" id="HESAP1" value=""></td>
							<td></td>
						</tr>
					</table>
				</td>
				<td>
					<table>
						<tr>
							<td title="Thickness in milimeters of the targeted plate.">Armor (mm)</td>
						</tr><tr>
							<td><input class="form-control"  type="number" step="any" min="0" id="armor" value="70"></td>
						</tr>
						<tr>
							<td title="Vertical inclination angle of the armor: 0° - perpendicular to sea level; >0° - turtleback; <0° - angled towards keel.">Armor Inclination (°)</td>
						</tr><tr>
							<td><input class="form-control" type="number" step="any" min="-90" max="180" id="inclination" value="0"></td>
						</tr>
						<tr>
							<td title="Width (Beam) of the targeted ship in meters.">Ship Width (m)</td>
						</tr><tr>
							<td><input class="form-control" type="number" step="any" min="0" id="width" value="18"> </p></td>
						</tr>
					</table>
				</td>
				<td>
					<div class="form-group form-inline">
						<label >Angle 0 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle0" value="0" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 1 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle1" value="5" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 2 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle2" value="10" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 3 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle3" value="15" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 4 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle4" value="20" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 5 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle5" value="25" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 6 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle6" value="30" >
						</div>
					</div>
					<div class="form-group form-inline">
						<label >Angle 7 (°)</label>
						<div class="col-sm-1">
							<input class="form-control" type="number" step="any" id="angle7" value="35" >
						</div>
					</div>
				</td>
			</tr>
		</table>
		<button id=generate class="btn btn-primary btn-lg btn-block">Generate Graphs</button>
		</div>
		</div>
		<h2 style="text-align:center">Graphs</h2>
		<button id=impactChartToggle class="btn btn-primary-outline btn-lg btn-block" data-toggle="collapse" data-target="#impactCharts">At Impact</button>
		<div class="collapse" id=impactCharts>

			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#pC0" id="PCT0"> Horizontal Penetration</button>
			<div class='collapse' id="pC0">
				<div class='col-sm-12'>
					<canvas id="penChart0" width="1200" height="300"></canvas>
				</div>	
			</div>
			
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#pC1" id="PCT1"> Deck Penetration</button>
			<div class='collapse' id="pC1">
				<div class='col-sm-12'>
					<canvas id="penChart1" width="1200" height="300"></canvas>
				</div>	
			</div>
			
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#pC2" id="PCT2"> Shell Speed</button>
			<div class='collapse' id="pC2">
				<div class='col-sm-12'>
					<canvas id="penChart2" width="1200" height="300"></canvas>
				</div>	
			</div>
		</div>
		
		<button id=angleChartToggle class="btn btn-primary-outline btn-lg btn-block" data-toggle="collapse" data-target="#angleCharts">Critical Lateral Angles</button>
		<div class="collapse" id=angleCharts>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#CA0" id="AC0"> Maximum Lateral Angle for Perforation</button>
			<div class='collapse' id="CA0">
				<div class='col-sm-12'>
					<canvas id="angleChart0" width="1200" height="300"></canvas>
				</div>	
			</div>

			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#CA1" id="AC1"> Minimum Lateral Angle for Fusing</button>
			<div class='collapse' id="CA1">
				<div class='col-sm-12'>
					<canvas id="angleChart1" width="1200" height="300"></canvas>
				</div>	
			</div>
		</div>


		<button id=postPenChartToggle class="btn btn-primary-outline btn-lg btn-block" data-toggle="collapse" data-target="#postPenCharts">Post Penetration</button>
		<div class="collapse" id=postPenCharts>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA0" id="A0">Lateral Angle 0</button>
			<div class='collapse' id="LA0">
				<div class='col-sm-12'>
					<canvas id="postPen0" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA1" id="A1">Lateral Angle 1</button>
			<div class='collapse' id="LA1">
				<div class='col-sm-12'>
					<canvas id="postPen1" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA2" id="A2">Lateral Angle 2</button>
			<div class='collapse' id="LA2">
				<div class='col-sm-12'>
					<canvas id="postPen2" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA3" id="A3">Lateral Angle 3</button>
			<div class='collapse' id="LA3">
				<div class='col-sm-12'>
					<canvas id="postPen3" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA4" id="A4">Lateral Angle 4</button>
			<div class='collapse' id="LA4">
				<div class='col-sm-12'>
					<canvas id="postPen4" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA5" id="A5">Lateral Angle 5</button>
			<div class='collapse' id="LA5">
				<div class='col-sm-12'>
					<canvas id="postPen5" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA6" id="A6">Lateral Angle 6</button>
			<div class='collapse' id="LA6">
				<div class='col-sm-12'>
					<canvas id="postPen6" width="1200" height="300"></canvas>
				</div>
			</div>
			<button class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#LA7" id="A7">Lateral Angle 7</button>
			<div class='collapse' id="LA7">
				<div class='col-sm-12'>
					<canvas id="postPen7" width="1200" height="300"></canvas>
				</div>
            </div>
		</div>
    
    <script>
		//Buttons
		function showCollapsibles(){
			var targets = [
				'parameters',
				'impactCharts',
				'angleCharts',
				'postPenCharts'
			]
			for(const target of targets){
				$('#' + target).collapse('show');
			}
		}
		
		var versionValue = [];
		var nationValue = [];
		var typeValue = [];
		var shipValue = [];
		var shellValue = [];
		var typeData = [];
		var shellType = [];
		var initialized = false;
        var compiled = false;
        var dataURL = "static/data/"
		function generateVersion(id){
			$.ajax({
				url: dataURL + "versions.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + "version" + id)[0].innerHTML = '';
					var i;
					for(i=0; i<data.length; i++){
						$('#' + "version" + id)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}

					onChangeVersion("version" + id);
				},
				error: function(response){
					console.log("Generating version failed")
					console.log(response);
					console.log(response['status'])
					console.log(response.statusCode())
				}
			})
		}
		function onChangeVersion(versionID){
			var id = parseInt(versionID.slice(-1));
			versionValue[id] = $('#' + versionID)[0].value;
			generateNation("nation" + id);
		}

		function generateNation(nationID){
			var id = parseInt(nationID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/nations.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + nationID)[0].innerHTML = '';
					var i;
					for(i=0; i<data.length; i++){
						$('#' + nationID)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}
					onChangeNation(nationID);
				},
				error: function(response){
					console.log("Generating nation failed")
					console.log(response);
					console.log(response['status'])
					console.log(response.statusCode())
				}
			})
		}
		function onChangeNation(nationID){
			var id = parseInt(nationID.slice(-1));
			nationValue[id] = $('#' + nationID)[0].value;
			generateType('type' + id);
		}

		function generateType(typeID){
			var id = parseInt(typeID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/" + nationValue[id] + "/shiptypes.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + typeID)[0].innerHTML = '';
					var i;
					for(i=0; i<data.length; i++){
						$('#' + typeID)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}
					onChangeType(typeID);
				},
				error: function(response){
					console.log("Generating type failed")
					console.log(response);
					console.log(response['status'])
					console.log(response.statusCode())
				}
			})
		}
		function onChangeType(typeID){
			var id = parseInt(typeID.slice(-1));
			typeValue[id] = $('#' + typeID)[0].value;
			generateShip('ship' + id)
		}

		function generateShip(shipID){
			var id = parseInt(shipID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/" + nationValue[id] + "/" + nationValue[id] + "_" + typeValue[id] + ".json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					typeData[id] = data;
					$('#' + shipID)[0].innerHTML = '';
					var sorted = []
					for(var ship in data){
						sorted.push(ship);
					}
					sorted.sort(function(a, b){return data[a]['Tier'] - data[b]['Tier']});
					for(var ship of sorted){
						$('#' + shipID)[0].innerHTML += "<option value=" + ship + ">" + "Tier " + data[ship]['Tier'] + " " + ship + "</option>"
					}
					onChangeShip(shipID);
				},
				error: function(response){
					console.log("Generating ship failed")
					console.log(response);
					console.log(response['status'])
					console.log(response.statusCode())
				}
			})
		}
		function onChangeShip(shipID){
			var id = parseInt(shipID.slice(-1));
			shipValue[id] = $('#' + shipID)[0].value;
			generateShell('shell' + id);
		}

		function generateShell(shellID){
			var id = parseInt(shellID.slice(-1));
			selector = $('#' + shellID)[0];
			selector.innerHTML = '';
			for(var shell in typeData[id][shipValue[id]]){
				if(shell.includes('Artillery')){
					selector.innerHTML += "<option value=" + shell + ">" + shell + "</option>";
				}
			}
			onChangeShell(shellID);
		}
		function onChangeShell(shellID){
			var id = parseInt(shellID.slice(-1));
			shellValue[id] = $('#' + shellID)[0].value;
			generateShellType("shellType" + id);
		}

		function generateShellType(shellTypeID){
			var id = parseInt(shellTypeID.slice(-1));
			selector = $('#' + shellTypeID)[0];
			selector.innerHTML = '';
			for(var shellType in typeData[id][shipValue[id]][shellValue[id]]){
				selector.innerHTML += "<option value=" + shellType + ">" + shellType + "</option>";
			}
			onChangeShellType(shellTypeID);
		}

		function onChangeShellType(shellTypeID){
			var id = parseInt(shellTypeID.slice(-1));
			shellType[id] = $('#' + shellTypeID)[0].value;
			onSubmitPredefined(id);
		}

		function onSubmitPredefined(id){
			var targetShell = typeData[id][shipValue[id]][shellValue[id]][shellType[id]];
			$("#shipName"  + id)[0].value = shipValue[id] + " " + shellValue[id].slice(-1);
			$("#mv"        + id)[0].value = targetShell["bulletSpeed"];
			$("#caliber"   + id)[0].value = targetShell["bulletDiametr"];
			$("#krupp"     + id)[0].value = targetShell["bulletKrupp"];
			$("#mass"      + id)[0].value = targetShell["bulletMass"];
			$("#cD"        + id)[0].value = targetShell["bulletAirDrag"];
			$("#threshold" + id)[0].value = targetShell["bulletDetonatorThreshold"];
			$("#fusetime"  + id)[0].value = targetShell["bulletDetonator"];
			$("#ra0_"      + id)[0].value = targetShell["bulletRicochetAt"];
			$("#ra1_"      + id)[0].value = targetShell["bulletAlwaysRicochetAt"];
			$("#normal"    + id)[0].value = targetShell['bulletCapNormalizeMaxAngle']
			if(shellType[id] == 'AP'){
				$("#HESAP" + id)[0].value = 0;
			}else if(shellType[id] == 'HE'){
				$("#HESAP" + id)[0].value = targetShell["alphaPiercingHE"];
			}else if(shellType[id] == 'CS'){
				$("#HESAP" + id)[0].value = targetShell["alphaPiercingCS"];
			}   
		}

		//Graphs

		var v_angles = [];
		var numAngles = 8;

		function getFloatValues(elementId){
			return parseFloat($('#' + elementId)[0].value);
		}

		var impactCharts = []
		var angleCharts = []
		var postCharts = []

		function makeGraphs(){
			var v_mv = [];
			var v_caliber = [];
			var v_krupp = [];
			var v_mass = [];
			var v_normal = [];
			var v_cD = [];
			var v_threshold = [];
			var v_fusetime = [];
			var v_ra0 = [];
			var v_ra1 = [];
			var v_HESAP = [];
			
			for(var i=0; i<2; i++){
				v_mv[i]        = getFloatValues("mv" + i);
				v_caliber[i]   = getFloatValues("caliber" + i);
				v_krupp[i]     = getFloatValues("krupp" + i);
				v_mass[i]      = getFloatValues("mass" + i);
				v_normal[i]    = getFloatValues("normal" + i);
				v_cD[i]        = getFloatValues("cD" + i);
				v_threshold[i] = getFloatValues("threshold" + i);
				v_fusetime[i]  = getFloatValues("fusetime" + i);
				v_ra0[i]       = getFloatValues("ra0_" + i);
				v_ra1[i]       = getFloatValues("ra1_" + i);
				v_HESAP[i]     = getFloatValues("HESAP" + i);
			}
			
			var v_armor       = getFloatValues("armor");
			var v_inclination = getFloatValues("inclination");
			var width         = getFloatValues("width");
			for(var i=0; i<numAngles; i++){
				v_angles[i] = parseFloat($('#' + "angle" + i)[0].value);
			}
			
			var instances = []
			for(var k=0; k<2; k++){
				instances[k] = new Module.shell(
					v_caliber[k], 
					v_mv[k], 
					v_cD[k], 
					v_mass[k], 
					v_krupp[k], 
					v_normal[k], 
					v_fusetime[k], 
					v_threshold[k], 
					v_ra0[k], 
					v_ra1[k]
				);
			}

			for(var k=0; k<2; k++){
				instances[k].calcImpact();
				instances[k].calcAngles(v_armor, v_inclination);
				instances[k].calcPostPen(v_armor, v_inclination, v_angles, true, false);
			}
			chartData = {
                width            : [],
				effectivePen     : [[], []],
				angleBelt        : [[], []],
				effectivePenDeck : [[], []],
				angleDeck        : [[], []],
				impactVelocity   : [[], []],
				flightTime       : [[], []],
				
				ra0              : [[], []],
				ra1              : [[], []],
				maxArmor      : [[], []],
				minFuse     : [[], []],

				detDist          : [[], []],
				detDistF         : [[], []],
			}

			for(var k=0; k<2; k++){
				for(var j=0; j<numAngles; j++){
					chartData.detDist[k].push( []);
					chartData.detDistF[k].push([]);
				}
			}
			//instance.printPostPen();
			//Values same for both shells
			var impactSize = instances[0].getImpactSize()
			var impactSizeAligned = instances[0].getImpactSizeAligned();
			var postPenSize = instances[0].getPostPenSize();
            
            var max = 0;
            if(instances[1].getImpactPoint(impactSize - 1, Module.impactDataIndex.distance.value) >
            instances[0].getImpactPoint(impactSize - 1, Module.impactDataIndex.distance.value)){
                max = 1;
            }

            for(var i=0; i<impactSize; i++){
                chartData.width.push(
                    {
                        x: instances[max].getImpactPoint(i, Module.impactDataIndex.distance.value),
                        y: width
                    }
                )
            }

			for(var k=0; k<2; k++){
				if(shellType[k] == 'AP'){
					for(var i=0; i<impactSize; i++){
						//chartData.labels[k].push(          instances[k].impactData().get(i+impactSizeAligned*Module.impactDataIndex.distance.value));
						chartData.effectivePen[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.ePenHN.value)
							}
						);
						chartData.angleBelt[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactAHD.value) * -1
							}

						);
						chartData.effectivePenDeck[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.ePenDN.value)
							}

						);
						chartData.angleDeck[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactADD.value)
							}       
						);
						chartData.impactVelocity[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactV.value)
							}
						);
						chartData.flightTime[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.tToTargetA.value)
							}
						);
						chartData.ra0[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.ra0D.value)
							}
						);
						chartData.ra1[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.ra1D.value)
							}
						);
						chartData.maxArmor[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.armorD.value)
							}
						);
						chartData.minFuse[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.fuseD.value)
							}
						);


						for(var j=0; j<numAngles; j++){
							chartData.detDist[k][j].push(
								{
									x: instances[k].getPostPenPoint(i, Module.postPenDataIndex.distance.value, j),
									y: instances[k].getPostPenPoint(i, Module.postPenDataIndex.x.value, j)
								}
							);
							var y = instances[k].getPostPenPoint(i, Module.postPenDataIndex.xwf.value, j);
							if(y >= 0){
								chartData.detDistF[k][j].push(
									{
										x: instances[k].getPostPenPoint(i, Module.postPenDataIndex.distance.value, j),
										y: instances[k].getPostPenPoint(i, Module.postPenDataIndex.xwf.value, j)
									}
								);
							}
						}
					}
				}else{
					for(var i=0; i<impactSize; i++){
						//chartData.labels[k].push(          instances[k].impactData().get(i+impactSizeAligned*Module.impactDataIndex.distance.value));
						chartData.effectivePen[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: v_HESAP[k]
							}
						);
						chartData.angleBelt[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactAHD.value) * -1
							}

						);
						chartData.effectivePenDeck[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: v_HESAP[k]
							}

						);
						chartData.angleDeck[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactADD.value)
							}       
						);
						chartData.impactVelocity[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.impactV.value)
							}
						);
						chartData.flightTime[k].push(
							{
								x: instances[k].getImpactPoint(i, Module.impactDataIndex.distance.value),
								y: instances[k].getImpactPoint(i, Module.impactDataIndex.tToTargetA.value)
							}
						);
						chartData.ra0[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.ra0D.value)
							}
						);
						chartData.ra1[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.ra1D.value)
							}
						);
						chartData.maxArmor[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.armorD.value)
							}
						);
						chartData.minFuse[k].push(
							{
								x: instances[k].getAnglePoint(i, Module.angleDataIndex.distance.value),
								y: instances[k].getAnglePoint(i, Module.angleDataIndex.fuseD.value)
							}
						);


						for(var j=0; j<numAngles; j++){
							chartData.detDist[k][j].push(
								{
									x: instances[k].getPostPenPoint(i, Module.postPenDataIndex.distance.value, j),
									y: instances[k].getPostPenPoint(i, Module.postPenDataIndex.x.value, j)
								}
							);
							var y = instances[k].getPostPenPoint(i, Module.postPenDataIndex.xwf.value, j);
							if(y >= 0){
								chartData.detDistF[k][j].push(
									{
										x: instances[k].getPostPenPoint(i, Module.postPenDataIndex.distance.value, j),
										y: instances[k].getPostPenPoint(i, Module.postPenDataIndex.xwf.value, j)
									}
								);
							}
						}
					}
				}
			}
			
			for(var k=0; k<2; k++){
				instances[k].delete();
			}

			var xStepSize = 2500
			//Set Impact
			if(impactCharts[0]){
				impactCharts[0].destroy();
			}
			var svs = []
			if(initialized){
				for(var k=0; k<2; k++){
					svs[k] = shellValue[k].slice(-1);
				}
			}else{
				svs[0] = 0;
				svs[1] = 0;
			}

			shipName = [];
			for(var k=0; k<2; k++){
				shipName[k] = $("#shipName" + k).value;
			}
			
			xAxesDistance = [{
				scaleLabel: {
					display: true,
					labelString: "Distance from Launch (m)",
				},
				ticks:{
					min: 0, stepSize: xStepSize
				}
			}];

			yAxesPenetration = {
				id: "Penetration", postition: "left",
				scaleLabel: {
					display: true,
					labelString: "Belt Penetration (mm)",
				},
				ticks: {
					stepSize: 100
				}
			}

			targetedArmor = 'Armor Thickness: ' + v_armor + 'mm';
			targetInclination = 'Vertical Inclination: ' + v_inclination + '°'; 

			var EPL = "Effective Penetration ";
			var IAL = "Impact Angle ";
			impactCharts[0] = new Chart($("#penChart0"), {
				type: 'scatter',
				data: {
					datasets: [
						{
							data: chartData.effectivePen[0],
							label: EPL + shipName[0], 
							yAxisID: "Penetration",
							borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.angleBelt[0],
							label: IAL + shipName[0], 
							yAxisID: "Angle",
							borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.effectivePen[1],
							label: EPL + shipName[1], 
							yAxisID: "Penetration",
							borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.angleBelt[1],
							label: IAL + shipName[1], 
							yAxisID: "Angle",
							borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Horizontal Penetration and Impact Angle'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [yAxesPenetration ,{
							id: "Angle", position: "right",
							scaleLabel: {
								display: true,
								labelString: "Belt Impact Angle (°)",
							},
						}
						]
					}
				}
			});

			if(impactCharts[1]){
				impactCharts[1].destroy();
			}
			var EDP = "Effective Deck Penetration ";
			var DIA = "Deck Impact Angle ";
			impactCharts[1] = new Chart($("#penChart1"), {
				type: 'scatter',
				data: {
					datasets: [
						{
							data: chartData.effectivePenDeck[0],
							label: EDP + shipName[0],
							yAxisID: "Penetration",
							borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.angleDeck[0],
							label: DIA + shipName[0], 
							yAxisID: "Angle",
							borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.effectivePenDeck[1],
							label: EDP + shipName[1],
							yAxisID: "Penetration",
							borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.angleDeck[1],
							label: DIA + shipName[1], 
							yAxisID: "Angle",
							borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Deck Penetration and Impact Angle'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [yAxesPenetration,{
							id: "Angle", position: "right",
							scaleLabel: {
								display: true,
								labelString: "Deck Impact Angle (°)",
							},
						}
						]
					}
				}
			});

			if(impactCharts[2]){
				impactCharts[2].destroy();
			}
			var IVL = "Impact Velocity ";
			var FTL = "Flight Time ";
			impactCharts[2] = new Chart($("#penChart2"), {
				type: 'scatter',
				data: {
					datasets: [
						{
							data: chartData.impactVelocity[0],
							label: IVL + shipName[0], 
							yAxisID: "Impact Velocity",
							borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.flightTime[0],
							label: FTL + shipName[0], 
							yAxisID: "Time",
							borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.impactVelocity[1],
							label: IVL + shipName[1], 
							yAxisID: "Impact Velocity",
							borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.flightTime[1],
							label: FTL + shipName[1], 
							yAxisID: "Time",
							borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Shell Flight Time and Impact Velocity'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "Impact Velocity", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Impact Velocity (m/s)",
							},
							ticks: {
								stepSize: 100
							}
						},{
							id: "Time", position: "right",
							scaleLabel: {
								display: true,
								labelString: "Flight Time (s)",
							},
						}
						]
					}
				}
			});

			//Set Angle Charts
			if(angleCharts[0]){
				angleCharts[0].destroy();
			}
			var armorL = "Maximum Perforation Angle ";
			var ra0L = "Start Ricochet "
			var ra1L = "Always Ricochet "
			//var FTL = " ";
			angleCharts[0] = new Chart($("#angleChart0"), {
				type: 'scatter',
				data: {
					datasets: [
						{
							data: chartData.maxArmor[0],
							label: armorL + shipName[0], 
							yAxisID: "angle",
							borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra0[0],
							label: ra0L + shipName[0], 
							yAxisID: "angle",
							borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra1[0],
							label: ra1L + shipName[0], 
							yAxisID: "angle",
							borderColor: "#FFD700", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.maxArmor[1],
							label: armorL + shipName[1], 
							yAxisID: "angle",
							borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra0[1],
							label: ra0L + shipName[1], 
							yAxisID: "angle",
							borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra1[1],
							label: ra1L + shipName[1], 
							yAxisID: "angle",
							borderColor: "#DC143C", fill: false, pointRadius: 0, pointHitRadius: 5
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Maximum Angle for Perforation | ' + targetedArmor + ' | ' + targetInclination
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "angle", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Lateral Angle (°)",
							},
							ticks:{
								min: 0
							}
						}]
					}
				}
			});
			
			if(angleCharts[1]){
				angleCharts[1].destroy();
			}
			var fuseL = "Minimum Fusing Angle ";
			//var FTL = " ";
			angleCharts[1] = new Chart($("#angleChart1"), {
				type: 'scatter',
				data: {
					datasets: [
						{
							data: chartData.minFuse[0],
							label: fuseL + shipName[0], 
							yAxisID: "angle",
							borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra0[0],
							label: ra0L + shipName[0], 
							yAxisID: "angle",
							borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra1[0],
							label: ra1L + shipName[0], 
							yAxisID: "angle",
							borderColor: "#FFD700", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.minFuse[1],
							label: fuseL + shipName[1], 
							yAxisID: "angle",
							borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra0[1],
							label: ra0L + shipName[1], 
							yAxisID: "angle",
							borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
						},{
							data: chartData.ra1[1],
							label: ra1L + shipName[1], 
							yAxisID: "angle",
							borderColor: "#DC143C", fill: false, pointRadius: 0, pointHitRadius: 5
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Minimum Fusing Angle | ' + targetedArmor + ' | ' + targetInclination
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "angle", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Lateral Angle (°)",
							},
							ticks:{
								min: 0
							}
						}]
					}
				}
			});
			
			//Set PostPen
			var width = $('#width').value
			var i;
			var WFL = "Check Fusing ";
			var NFL = "Always Fusing ";
			for(i=0; i<numAngles; i++){
				var str = "Lateral Angle " + i + ": " + v_angles[i] + "°";
				$("#A" + i)[0].textContent = str;
				if(postCharts[i]){
					postCharts[i].destroy()
				}

				postCharts[i] = new Chart($("#postPen" + i), {
					type: 'scatter',
					data: {
						datasets: [
							{
								data: chartData.detDistF[0][i],
								label: WFL + shipName[0],
								borderColor: "#FFA500", fill: false, pointRadius: 0, pointHitRadius: 5
							},{
								data: chartData.detDist[0][i],
								label: NFL + shipName[0],
								borderColor: "#3e95cd", fill: false, pointRadius: 0, pointHitRadius: 5
							},{
								data: chartData.detDistF[1][i],
								label: WFL + shipName[1],
								borderColor: "#FF0000", fill: false, pointRadius: 0, pointHitRadius: 5
							},{
								data: chartData.detDist[1][i],
								label: NFL + shipName[1],
								borderColor: "#008000", fill: false, pointRadius: 0, pointHitRadius: 5
							},{
								data: chartData.width,
								label: "Ship Width (m)",
								borderColor: "#505050", fill: false, pointRadius: 0, pointHitRadius: 5
							}
						]
					},
					options: {
						title: {
							display: true,
							text: 'Internal Width Traveled before Detonation | ' + targetedArmor + ' | ' + targetInclination + ' | Horizontal Impact Angle: ' + v_angles[i] + "°"
						},
						scales: {
							xAxes: xAxesDistance,
							yAxes: [{
								scaleLabel: {
									display: true,
									labelString: "Shell Detonation Distance (m)",
								},
							}]
						}
					}
				});
			}
		}
        //Buttons 
		//Add Hide buttons
        let touchEvent = 'ontouchstart' in window ? 'touchstart' : 'click';
		$("#generate")[0].addEventListener(touchEvent, function(){makeGraphs();});

		$(document).ready(function(){
			generateVersion(0);
            generateVersion(1);
			showCollapsibles();
            initialized = true;
		})

		var Module = {
			onRuntimeInitialized: function() {
				console.log("Wasm Compile Successful");
                compiled = true;

			}
		};
    </script>
	<script src="shellWasm1.js"></script>
	<p>If you find a bug or want a new feature, please <a href="https://github.com/jcw780/overpen_calculator/issues">open an issue</a> at GitHub. Your suggestions will be considered at later development.</p>
	</body>
</html>