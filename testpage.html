<!DOCTYPE html>
<html lang="en">

	<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155844497-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-155844497-1');
	</script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
    <title>World of Warships Ballistics Calculator</title>
	</head>

	<body>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://unpkg.com/wasm-feature-detect/dist/umd/index.js"></script>
		<script src="https://unpkg.com/bowser@2.7.0/es5.js"></script>
		<script src="shellWasm.js"></script>
		<script src="shellWasmV.js"></script>

		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
		<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js'></script>
		<script src='https://chartjs.org/samples/latest/utils.js'></script>
		<style>
			body{
				background-color: white;
			}
			table{
                border: 15px solid white;
                background-color: white;
            }
            td{
                border: 5px solid white;
                background-color: white;
            }
            tr {
			    border: 5px solid white;
                background-color: white;
			}

            th{
                border: 15px solid white;
                background-color: white;
            }
            canvas{
                background-color: white;
            }
			input{
				box-shadow: 0px 0px #888888;
				border-style: solid;
  				border-width: 2px;
			}
			select{
				box-shadow: 0px 0px #888888;
				border-style: solid;
  				border-width: 2px;
			}

			.btn-info{
				background-color: teal;
				border-color: teal;
			}

			.btn-info:hover{
				background-color: rgb(0,96,96);
				border-color: rgb(0,96,96);
			}

			.btn-info:not(:disabled):not(.disabled).active, 
			.btn-info:not(:disabled):not(.disabled):active, 
			.show>.btn-info.dropdown-toggle {
				background-color: rgb(0,96,96);
				border-color: rgb(0,96,96);
			}

			.btn-info:not(:disabled):not(.disabled).active:focus, 
			.btn-info:not(:disabled):not(.disabled):active:focus,
			.btn-info.focus, .btn-info:focus, 
			.show>.btn-info.dropdown-toggle:focus {
				box-shadow: 0 0 0 0.2rem rgba(0,96,96,.5);
			}

			.btn-primary{
				background-color: orange;
				border-color: orange;
			}

			.btn-primary:hover{
				background-color: rgb(192,124,0);
				border-color: rgb(192,124,0);
			}

			.btn-primary:not(:disabled):not(.disabled).active, 
			.btn-primary:not(:disabled):not(.disabled):active, 
			.show>.btn-primary.dropdown-toggle {
				background-color: rgb(192,124,0);
				border-color: rgb(192,124,0);
			}

			.btn-primary:not(:disabled):not(.disabled).active:focus, 
			.btn-primary:not(:disabled):not(.disabled):active:focus,
			.btn-primary.focus, .btn-primary:focus, 
			.show>.btn-primary.dropdown-toggle:focus {
				box-shadow: 0 0 0 0.2rem rgba(192,124,0,.5);
			}

			.btn-success{
				background-color: purple;
				border-color: purple;
			}

			.btn-success:hover{
				background-color: rgb(96,0,96);
				border-color: rgb(96,0,96);
			}

			.btn-success:not(:disabled):not(.disabled).active, 
			.btn-success:not(:disabled):not(.disabled):active, 
			.show>.btn-success.dropdown-toggle {
				color: #fff;
				background-color: rgb(96,0,96);
				border-color: rgb(96,0,96);
			}

			.btn-success:not(:disabled):not(.disabled).active:focus, 
			.btn-success:not(:disabled):not(.disabled):active:focus,
			.btn-success.focus, .btn-success:focus,
			.show>.btn-success.dropdown-toggle:focus {
				box-shadow: 0 0 0 0.2rem rgba(96,0,96,.5);
			}

			.margin-bottom {
				margin-bottom:5px;
			}

			.download-align{
				margin-left: 45%;
				width: 10%;
				margin-right: 45%;
				margin-bottom: 10px;
			}

		</style>
		<h1 style="text-align: center;">World of Warships Ballistics Calculator</h1>
		<button id="descriptionsToggle" class="btn btn-info btn-lg btn-block" 
		data-toggle="collapse" data-target="#descriptions">Description
			<span class="fa fa-chevron-up fa-resize-full"></span>
		</button>
		<div class="collapse" id=descriptions style="width: 100%;">
			<div style="padding-left: 2em;">
				<h4>Functionality</h4>
				<h5 style="padding-left: 2em;">Calculate shell performance at impact and in flight</h5>
				<p style="padding-left: 4em;">Belt/Deck penetration - Belt/Deck Impact Angle - Impact Velocity - Flight Time</p>
				<p style="padding-left: 4em;">Includes all shell types (AP, HE, SAP(CS)) - only for 0.9.1.1 and later</p>
				<h5 style="padding-left: 2em;">Calculate Critical Angles</h5>
				<p style="padding-left: 4em;">Maximum angle for penetration - Minimum angle for fusing - Lateral ricochet angles</p>
				<h5 style="padding-left: 2em;">Calculate AP performance post penetration</h5> 
				<p style="padding-left: 4em;">Shell detonation distance after penetration - Checking whether the armor is thick enough to arm the shell</p>
				<p>Overpen calculations are experimental - further testing may be needed to confirm results.</p>
				<p>Site will be updated if and when more accurate information becomes available.</p>
			</div>
		</div>

		<button id="parametersToggle" class="btn btn-info btn-lg btn-block" 
		data-toggle="collapse" data-target="#parameters">Input Data
			<span class="fa fa-chevron-up fa-resize-full"></span>
		</button>
		<div class="collapse" id=parameters style="width: 100%; background-color: lightgray;" >
		<table id=parameterTable style="width: 100%;">
			<tr style="width: 100%;">
				<th>
					<h3 style="text-align: center;"><u>Predefined Shells</u></h3>
				</th>
				<th>
					<h3 style="text-align: center;"><u>Shell Data</u></h3>
				</th>
				<th>
					<h3 style="text-align: center;"><u>Target Data</u></h3>
				</th>
			</tr>
			<tr style="width: 100%;">
				<td>
					<form>
						<div class="row margin-bottom">
							<div class="col-sm-4"><h4>Ship A:</h4></div>
							<div class="col-sm-8"></div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Version</label>
							<div class="col-sm-8">
								<select id=version0   class="form-control" onchange="onChangeVersion('version0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Nation</label>
							<div class="col-sm-8">
								<select id=nation0    class="form-control" onchange="onChangeNation('nation0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Type</label>
							<div class="col-sm-8">
								<select id=type0      class="form-control"   onchange="onChangeType('type0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Ship</label>
							<div class="col-sm-8">
								<select id=ship0      class="form-control"   onchange="onChangeShip('ship0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Artillery</label>
							<div class="col-sm-8">
								<select id=shell0     class="form-control"  onchange="onChangeShell('shell0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Shell Type</label>
							<div class="col-sm-8">
								<select id=shellType0 class="form-control"  onchange="onChangeShellType('shellType0')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<div class="col-sm-4">
								<button type="button" class="btn btn-success btn-block" id="apply0">Apply</button>
							</div>
							<div class="btn-group-toggle" data-toggle="buttons">
								<label class="btn btn-block btn-info active">
									  <input id="autoApply0" type="checkbox" checked> Apply On Change
								</label>
							</div>
						</div>
						<div class="row margin-bottom">
							<div class="col-sm-4"><h4>Ship B:</h4></div>
							<div class="col-sm-8"></div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Version</label>
							<div class="col-sm-8">
								<select id=version1   class="form-control" onchange="onChangeVersion('version1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Nation</label>
							<div class="col-sm-8">
								<select id=nation1    class="form-control" onchange="onChangeNation('nation1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Type</label>
							<div class="col-sm-8">
								<select id=type1      class="form-control"   onchange="onChangeType('type1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Ship</label>
							<div class="col-sm-8">
								<select id=ship1      class="form-control"   onchange="onChangeShip('ship1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Artillery</label>
							<div class="col-sm-8">
								<select id=shell1     class="form-control"  onchange="onChangeShell('shell1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Shell Type</label>
							<div class="col-sm-8">
								<select id=shellType1 class="form-control"  onchange="onChangeShellType('shellType1')"></select>
							</div>
						</div>
						<div class="form-row margin-bottom">
							<div class="col-sm-4">
								<button type="button" class="btn btn-success btn-block" id="apply1">Apply</button>
							</div>
							<div class="btn-group-toggle" data-toggle="buttons">
								<label class="btn btn-block btn-info active">
									  <input id="autoApply1" type="checkbox" checked> Apply On Change
								</label>
							</div>
						</div>
					</form>
				</td>
				<td>
					<form>
						<div class="row margin-bottom">
							<div class="col-sm-4"><h4>Shell Attributes</h4></div>
							<div class="col-sm-4"><h4>Ship A:</h4></div>
							<div class="col-sm-4"><h4>Ship B:</h4></div>
						</div>
						<div class="form-row margin-bottom">
							<label id="caliberL" class="col-sm-4 col-form-label">Caliber (m)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="caliber0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="caliber1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="mvL" class="col-sm-4 col-form-label">Muzzle Velocity (m/s)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="mv0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="mv1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="cDL" class="col-sm-4 col-form-label">Drag Coefficent</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="cD0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="cD1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="massL" class="col-sm-4 col-form-label">Mass (kg)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="mass0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="mass1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="kruppL" class="col-sm-4 col-form-label">Krupp</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="krupp0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="krupp1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="fusetimeL" class="col-sm-4 col-form-label">Fusetime (s)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="fusetime0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="fusetime1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="thresholdL" class="col-sm-4 col-form-label">Fusing Threshold (mm)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="threshold0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="threshold1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="normalL" class="col-sm-4 col-form-label">Normalization (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="normal0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="normal1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="ra0L" class="col-sm-4 col-form-label">Start Ricochet (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="ra0_0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="ra0_1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="ra1L" class="col-sm-4 col-form-label">Always Ricochet (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="ra1_0"   value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" max="91" id="ra1_1"   value="">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label id="HESAPL" class="col-sm-4 col-form-label">HE/SAP penetration (mm)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="HESAP0"   value="0">
							</div>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="HESAP1"   value="0">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-4 col-form-label">Graph Label</label>
							<div class="col-sm-4">
								<input class="form-control" id="shipName0" value="">
							</div>
							<div class="col-sm-4">
								<input class="form-control" id="shipName1" value="">
							</div>
						</div>
						<div class="row margin-bottom">
							<div class="col-sm-4"></div>
							<div class="col-sm-4">
								<div class="btn-group-toggle" data-toggle="buttons">
									<label class="btn btn-block btn-info active">
									  	<input id="graphShip0" type="checkbox" checked> Graph
									</label>
								</div>
							</div>
							<div class="col-sm-4">
								<div class="btn-group-toggle" data-toggle="buttons">
									<label class="btn btn-block btn-info active">
									  	<input id="graphShip1" type="checkbox" checked> Graph
									</label>
								</div>
							</div>
						</div>
					</form>
				</td>
				<td>
					<h4>Target Armor</h4>
					<form>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label" 
							title="Thickness in milimeters of the targeted plate.">Armor (mm)</label>
							<div class="col-sm-4">
								<input class="form-control"  type="number" step="any" min="0" id="armor" value="70">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label" 
							title="Vertical inclination angle of the armor: 0° - perpendicular to sea level; >0° - turtleback; <0° - angled towards keel.">Armor Inclination (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="-90" max="180" id="inclination" value="0">
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label" 
							title="Width (Beam) of the targeted ship in meters.">Ship Width (m)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="0" id="width" value="18">
							</div>
						</div>
					</form>
					<h4 title="For post-penetration graphs only.">Horizontal Impact Angles</h4>
					<form>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 0 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle0" value="0" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 1 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle1" value="5" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 2 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle2" value="10" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 3 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle3" value="15" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 4 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle4" value="20" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 5 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle5" value="25" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 6 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle6" value="30" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-5 col-form-label">Angle 7 (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" id="angle7" value="35" >
							</div>
						</div>
					</form>
				</td>
			</tr>
		</table>
		<div style="background-color: white;"><button id=generate class="btn btn-success btn-lg btn-block" style="margin-left:auto; margin-right:auto; width: 50%; margin-bottom: 20px;">Generate Graphs</button></div>
		</div>

		<button id="settingsToggle" class="btn btn-info btn-lg btn-block" 
		data-toggle="collapse" data-target="#settingsTab">Settings
			<span class="fa fa-chevron-up fa-resize-full"></span>
		</button>
		<div class="collapse" id=settingsTab style="width: 100%">
			<table>
				<tr>
					<th><h3>Graphs</h3></th>
					<th><h3>Calculation Method</h3></th>
					<th><h3>Calculation Parameters</h3></th>
				</tr>
				<tr>
					<td>
						<form>
							<div class="form-row margin-bottom">
								<label class="col-sm-5 col-form-label">Minimum Distance</label>
								<div class="col-sm-4">
									<input class="form-control" type="number" step="any" id="minDist" value="0" >
								</div>
							</div>
							<div class="form-row margin-bottom">
								<label class="col-sm-5 col-form-label">Maximum Distance</label>
								<div class="col-sm-4">
									<input class="form-control" type="number" step="any" id="maxDist" value="" >
								</div>
							</div>
							<div class="form-row margin-bottom">
								<label class="col-sm-5 col-form-label">Tick Size</label>
								<div class="col-sm-4">
									<input class="form-control" type="number" step="any" id="tickDist" value="2500" >
								</div>
							</div>
							<div class="form-row margin-bottom">
								<label class="col-sm-5 col-form-label">Rounding</label>
								<div class="col-sm-4">
									<input class="form-control" type="number" step="any" id="rounding" value="3" >
								</div>
							</div>
							<div class="col-sm-8">
								<div class="btn-group-toggle" data-toggle="buttons">
									<label class="btn btn-block btn-info active">
										  <input id="enableFills" type="checkbox" checked> Enable Fills
									</label>
								</div>
							</div>
						</form>
					</td>
					<td>
						<div class="btn-group-vertical btn-group-toggle" data-toggle="buttons">
							<label class="btn btn-info">
							  	<input type="radio" onchange="setComputation('AB5')"> Adams-Bashforth 5
							</label>
							<label class="btn btn-info">
							  	<input type="radio" onchange="setComputation('RK2')"> Runge-Kutta 2
							</label>
							<label class="btn btn-info">
							  	<input type="radio" onchange="setComputation('RK4')"> Runge-Kutta 4
							</label>
							<label class="btn btn-info active">
								<input type="radio" onchange="setComputation('FE')" checked> Forward Euler
							</label>
						  </div>
					</td>
					<td>
						<div class="form-row margin-bottom">
							<label class="col-sm-6 col-form-label">Time Step (s)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min=".00001" max="10" id="timeStep" value="0.01" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-6 col-form-label">Minimum Launch Angle (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="-90" max="90" id="minLaunch" value="0" >
							</div>
						</div>
						<div class="form-row margin-bottom">
							<label class="col-sm-6 col-form-label">Maximum Launch Angle (°)</label>
							<div class="col-sm-4">
								<input class="form-control" type="number" step="any" min="-90" max="90" id="maxLaunch" value="25" >
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>

		<h2 style="text-align:center">Graphs</h2>
		<button id=impactChartToggle class="btn btn-primary btn-lg btn-block" 
		data-toggle="collapse" data-target="#impactCharts">At Impact
			<span class="fa fa-chevron-up fa-resize-full"></span>	
		</button>
		<div class="collapse" id=impactCharts>

			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#pC0" id="PCT0"> Horizontal Penetration
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="pC0">
				<div class='col-sm-12'>
					<canvas id="penChart0" width="1200" height="300"></canvas>
				</div>
				<a id='penChartLink0' class='btn btn-success download-align'>Download Graph</a>	
			</div>
			
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#pC1" id="PCT1"> Deck Penetration
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="pC1">
				<div class='col-sm-12'>
					<canvas id="penChart1" width="1200" height="300"></canvas>
				</div>
				<a id='penChartLink1' class='btn btn-success download-align'>Download Graph</a>
			</div>
			
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#pC2" id="PCT2"> Shell Speed
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="pC2">
				<div class='col-sm-12'>
					<canvas id="penChart2" width="1200" height="300"></canvas>
				</div>	
				<a id='penChartLink2' class='btn btn-success download-align'>Download Graph</a>
			</div>
		</div>
		
		<button id=angleChartToggle class="btn btn-primary btn-lg btn-block" 
		data-toggle="collapse" data-target="#angleCharts">Critical Lateral Angles
			<span class="fa fa-chevron-up fa-resize-full"></span>
		</button>
		<div class="collapse" id=angleCharts>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#CA0" id="ACT0"> Maximum Lateral Angle for Perforation
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="CA0">
				<div class='col-sm-12'>
					<canvas id="angleChart0" width="1200" height="300"></canvas>
				</div>	
				<a id='angleChartLink0' class='btn btn-success download-align'>Download Graph</a>
			</div>

			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#CA1" id="ACT1"> Minimum Lateral Angle for Fusing
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="CA1">
				<div class='col-sm-12'>
					<canvas id="angleChart1" width="1200" height="300"></canvas>
				</div>	
				<a id='angleChartLink1' class='btn btn-success download-align'>Download Graph</a>
			</div>
		</div>

		<button id=postPenChartToggle class="btn btn-primary btn-lg btn-block" 
		data-toggle="collapse" data-target="#postPenCharts">Post Penetration
			<span class="fa fa-chevron-up fa-resize-full"></span>
		</button>
		<div class="collapse" id=postPenCharts>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA0" id="AT0">
			Lateral Angle 0
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA0">
				<div class='col-sm-12'>
					<canvas id="postPen0" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink0' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA1" id="AT1">
			Lateral Angle 1
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA1">
				<div class='col-sm-12'>
					<canvas id="postPen1" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink1' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA2" id="AT2">
			Lateral Angle 2
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA2">
				<div class='col-sm-12'>
					<canvas id="postPen2" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink2' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA3" id="AT3">
			Lateral Angle 3
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA3">
				<div class='col-sm-12'>
					<canvas id="postPen3" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink3' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA4" id="AT4">
			Lateral Angle 4
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA4">
				<div class='col-sm-12'>
					<canvas id="postPen4" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink4' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA5" id="AT5">
			Lateral Angle 5
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA5">
				<div class='col-sm-12'>
					<canvas id="postPen5" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink5' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA6" id="AT6">
			Lateral Angle 6
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA6">
				<div class='col-sm-12'>
					<canvas id="postPen6" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink6' class='btn btn-success download-align'>Download Graph</a>
			</div>
			<button class="btn btn-info btn-lg btn-block" 
			data-toggle="collapse" data-target="#LA7" id="AT7">
			Lateral Angle 7
			<span class="fa fa-chevron-up fa-resize-full"></span>
			</button>
			<div class='collapse' id="LA7">
				<div class='col-sm-12'>
					<canvas id="postPen7" width="1200" height="300"></canvas>
				</div>
				<a id='postPenLink7' class='btn btn-success download-align'>Download Graph</a>
            </div>
		</div>
    
    <script>
		var computationMethod = 'FE';
		var inputData = Object.seal({
			'mv'         : [  805,  805],
			'caliber'    : [ .102, .102],
			'krupp'      : [ 2300, 2300],
			'mass'       : [ 15.2, 15.2],
			'normal'     : [   10,   10],
			'cD'         : [.3536,.3536],
			'threshold'  : [   17,   17],
			'fusetime'   : [  .01,  .01],
			'ra0_'       : [45, 45],
			'ra1_'       : [60, 60],
			'HESAP'      : [0, 0],
			'shellType'  : ['AP', 'AP'],
			'angle'      : [0, 5, 10, 25, 20, 25, 30, 35],
			'armor'      : 70,
			'inclination': 0,
			'width'      : 18,
			'shipName'   : ['PUSD503_Vampire 0', 'PUSD503_Vampire 0']
		});

		var graphSettings = Object.seal({
			'minDist': '0',
			'maxDist': '',
			'tickDist': '2500',
			'rounding': '3',
			'enableFills': true,
		});

		function setComputation(value){computationMethod = value;}
		
		function addFormChange(){
			function settingsChange(){inputData[this.id] = parseFloat(this.value);}
			const targetSettingsTargets = [
				'armor', 'inclination', 'width',
			];
			targetSettingsTargets.map(function(value){
				document.getElementById(value).addEventListener('change', settingsChange);
			});
			function angleChange(){
				var id = this.id.slice(-1);
				inputData['angle'][id] = parseFloat(this.value);
			}
			const angleTargets = [
				'angle0', 'angle1', 'angle2', 'angle3', 
				'angle4', 'angle5', 'angle6', 'angle7', 
			];
			angleTargets.map(function(value){
				document.getElementById(value).addEventListener('change', angleChange);
			});

			function shipChange(){
				var id = this.id.slice(-1);
				var dataType = this.id.slice(0, -1);
				inputData[dataType][id] = parseFloat(this.value);	
			}

			const shipTargets = [
				'caliber0', 'caliber1',
				'mv0', 'mv1',
				'cD0', 'cD1',
				'mass0', 'mass1',
				'krupp0', 'krupp1',
				'fusetime0', 'fusetime1',
				'threshold0', 'threshold1',
				'normal0', 'normal1',
				'ra0_0', 'ra0_1',
				'ra1_0', 'ra1_1',
				'HESAP0', 'HESAP1',
			];

			shipTargets.map(function(value){
				document.getElementById(value).addEventListener('change', shipChange);
			});

			function shipNameChange(){
				var id = this.id.slice(-1);
				inputData['shipName'][id] = this.value;
			}

			const shipName = [
				'shipName0', 'shipName1',
			];

			shipName.map(function(value){
				document.getElementById(value).addEventListener('change', shipNameChange);
			});

			function changeTimeStep(){shellInstance.setDtMin(parseFloat(this.value));}
			function changeMinLaunch(){shellInstance.setMin(parseFloat(this.value));}
			function changeMaxLaunch(){shellInstance.setMax(parseFloat(this.value));}
			function changeGraphSettings(){graphSettings[this.id] = this.value;}
			function changeGraphButtons(){graphSettings[this.id] = this.checked;}

			const settings = [
				['minDist'  , changeGraphSettings],
				['maxDist'  , changeGraphSettings],
				['tickDist' , changeGraphSettings],
				['rounding' , changeGraphSettings],

				['enableFills', changeGraphButtons],

				['timeStep' , changeTimeStep ], 
				['minLaunch', changeMinLaunch], 
				['maxLaunch', changeMaxLaunch],
			]

			settings.map(function(value){
				//document.getElementById(value[0]).addEventListener('change', value[1]);
				$("#"+value[0]).change(value[1]);
			});

			const autoApplyButtons = [
				"autoApply0", "autoApply1"
			]

			autoApplyButtons.map(function(value){
				$("#"+value).change(function(){
					autoApply[this.id.slice(-1)] = this.checked;
				});
			});

			const graphShipButtons = [
				"graphShip0", "graphShip1"
			]

			graphShipButtons.map(function(value){
				$("#"+value).change(function(){
					graphShip[this.id.slice(-1)] = this.checked;
				});
			});
		}

		//Buttons 
		//Add Hide buttons
        addTitles();
		let touchEvent = 'ontouchstart' in window ? 'touchstart' : 'click';
		$("#generate")[0].addEventListener(touchEvent, collectMake);

		function changeChevron(e){
			e.stopPropagation();
			$(e.target).prev('button').find('span.fa').toggleClass('fa-chevron-up fa-chevron-down');
		}

		function addChevrons(){
			var collapseButtons = [
				'descriptions',
				'parameters',
				'settingsTab',
				'impactCharts',
				'angleCharts',
				'postPenCharts',
			]
			
			var graphs = {
				'pC': 3,
				'CA': 2,
				'LA': 8,
			}
			for(const id of collapseButtons){
				$('#' + id).on('shown.bs.collapse hidden.bs.collapse', changeChevron);
			}
			
			for(const [id, num] of Object.entries(graphs)){
				for(var i=0; i<num; i++){
					$('#' + id + i).on('shown.bs.collapse hidden.bs.collapse', changeChevron);
				}
			}
		}

		addChevrons();
		addFormChange();

		function applyButton(){
			onSubmitPredefined((this.id).slice(-1)); 
		}

		for(let i=0; i<2; i++){
			$('#apply' + i)[0].addEventListener(touchEvent, applyButton);
		}

		async function firstRun(){
			shellInstance.setDtMin(.01);
			shellInstance.setMin(0.0);
			shellInstance.setMax(25.0);
			const data = {
				'mv'         : [  805,  805],
				'caliber'    : [ .102, .102],
				'krupp'      : [ 2300, 2300],
				'mass'       : [ 15.2, 15.2],
				'normal'     : [   10,   10],
				'cD'         : [.3536,.3536],
				'threshold'  : [   17,   17],
				'fusetime'   : [  .01,  .01],
				'ra0_'       : [45, 45],
				'ra1_'       : [60, 60],
				'HESAP'      : [0, 0],
				'shellType'  : ['AP', 'AP'],
				'angle'      : [0, 5, 10, 25, 20, 25, 30, 35],
				'armor'      : 70,
				'inclination': 0,
				'width'      : 18,
				'shipName'   : ['PUSD503_Vampire 0', 'PUSD503_Vampire 0']
			}
			makeGraphs(data);
		}

		
		$(document).ready(async function(){
			showCollapsibles();
			const versions = [0, 1];
			const tasks = versions.map(
				function(input){return generateVersion(input);}
			)
			const results = await Promise.all(tasks);
		})

		var Module;

		wasmFeatureDetect.simd().then(simdSupported => {
			if (simdSupported) {
				console.log('vectorized');
				ShellWasmV().then(function (M) {
					//console.log('Ready', M);
					Module = M;
					shellInstance = new Module.shell(2);
					firstRun();
				})
			} else {
				console.log('unvectorized');
				var result = bowser.getParser(window.navigator.userAgent);
				/*if(result.parsedResult.browser.name == 'Chrome'){
					alert('Enable WebAssembly SIMD support in chrome://flags for increased performance.');
				}*/
				ShellWasm().then(function (M) {
					//console.log('Ready', M);
					Module = M;
					shellInstance = new Module.shell(2);
					firstRun();
				})
			}
		});
		//Buttons

		async function showCollapsibles(){
			const targets = [
				'parametersToggle',
				'impactChartToggle',
				'angleChartToggle',
				'postPenChartToggle'
			]
			for(const target of targets){
				$('#' + target).click();
			}
			const graphToggles = {
				'PCT': 3,
				'ACT': 2,
				'AT' : 8
			}

			for(const [k, v] of Object.entries(graphToggles)){
				for(let i = 0; i < v; i++){
					$('#' + k + i).click();
				}
			}
		}
		
		function addTitles(){
			var targets = {
				'caliberL' : 
					'Diameter of the shell in meters. All else equal, higher caliber increase shell flight time and reduces penetration.',
				'mvL': 
					'Shell velocity at launch in meters per second. All else equal, higher muzzle velocity reduces shell flight time and increase penetration.',
				'cDL': 
					"Aerodynamic drag characteristic of the shell's shape. All else equal, higher drag coefficient increase shell flight time and reduces penetration.",
				'massL': 
					"Mass of the shell in kilograms. All else equal, higher mass decreases shell flight time and increases penetration.",
				'kruppL': 
					"Penetration coefficient of the shell. All else equal, higher krupp increases penetration.",
				'fusetimeL': 
					"How many seconds it takes for the shell to detonate after fusing. Longer fusetime increases risk of overpenetration.",
				'thresholdL': 
					"How many milimeters of effective armor it takes for the shells arm. Higher fusing threshold increases the risk of overpenetration.",
				'ra0L':
					"Minimum impact angle in degrees at which shells can ricochet - not affected by normalization.",
				'ra1L':
					"Minimum impact angle in degrees at which shells always ricochet - not affected by normalization.",
				'HESAPL':
					"HE/SAP penetration of shell - if applicable.",
				'normalL':
					"How many degrees of impact angle the shell can reduce. Higher normalization increases decreases effective armor thickness."
			}
			for(const [key, value] of Object.entries(targets)){
				$('#'+key)[0].title = value;
			}
		}

		var versionValue = [];
		var nationValue = [];
		var typeValue = [];
		var shipValue = [];
		var shellValue = [];
		var typeData = [];
		var shellType = [];
		var autoApply = [true, true];
		var initialized = false;
        var compiled = false;
        var dataURL = "static/data/"
		function generateVersion(id){
			$.ajax({
				url: dataURL + "versions.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + "version" + id)[0].innerHTML = '';
					for(let i=data.length - 1; i>=0; i--){
						$('#' + "version" + id)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}
					onChangeVersion("version" + id);
				},
				error: function(response){
					console.log("Generating version failed");
					console.log(response);
					console.log(response['status']);
					console.log(response.statusCode());
				}
			})
		}
		function onChangeVersion(versionID){
			var id = parseInt(versionID.slice(-1));
			versionValue[id] = $('#' + versionID)[0].value;
			generateNation("nation" + id);
		}

		function generateNation(nationID){
			var id = parseInt(nationID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/nations.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + nationID)[0].innerHTML = '';
					for(let i=0; i<data.length; i++){
						$('#' + nationID)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}
					onChangeNation(nationID);
				},
				error: function(response){
					console.log("Generating nation failed");
					console.log(response);
					console.log(response['status']);
					console.log(response.statusCode());
				}
			})
		}
		function onChangeNation(nationID){
			var id = parseInt(nationID.slice(-1));
			nationValue[id] = $('#' + nationID)[0].value;
			generateType('type' + id);
		}

		function generateType(typeID){
			var id = parseInt(typeID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/" + nationValue[id] + "/shiptypes.json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					$('#' + typeID)[0].innerHTML = '';
					for(let i=0; i<data.length; i++){
						$('#' + typeID)[0].innerHTML += "<option value=" + data[i] + ">" + data[i] + "</option>"
					}
					onChangeType(typeID);
				},
				error: function(response){
					console.log("Generating type failed");
					console.log(response);
					console.log(response['status']);
					console.log(response.statusCode());
				}
			})
		}
		function onChangeType(typeID){
			var id = parseInt(typeID.slice(-1));
			typeValue[id] = $('#' + typeID)[0].value;
			generateShip('ship' + id)
		}

		function generateShip(shipID){
			var id = parseInt(shipID.slice(-1));
			$.ajax({
				url: dataURL + versionValue[id] + "/" + nationValue[id] + "/" + nationValue[id] + "_" + typeValue[id] + ".json",
				type: "GET",
				dataType: "json",
				success: function (data) {
					typeData[id] = data;
					$('#' + shipID)[0].innerHTML = '';
					var sorted = []
					for(let ship in data){
						sorted.push(ship);
					}
					sorted.sort(function(a, b){return data[a]['Tier'] - data[b]['Tier']});
					for(let ship of sorted){
						$('#' + shipID)[0].innerHTML += "<option value=" + ship + ">" + "Tier " + data[ship]['Tier'] + " " + ship + "</option>"
					}
					onChangeShip(shipID);
				},
				error: function(response){
					console.log("Generating ship failed");
					console.log(response);
					console.log(response['status']);
					console.log(response.statusCode());
				}
			})
		}
		function onChangeShip(shipID){
			var id = parseInt(shipID.slice(-1));
			shipValue[id] = $('#' + shipID)[0].value;
			generateShell('shell' + id);
		}

		function generateShell(shellID){
			var id = parseInt(shellID.slice(-1));
			selector = $('#' + shellID)[0];
			selector.innerHTML = '';
			for(let shell in typeData[id][shipValue[id]]){
				if(shell.includes('Artillery')){
					selector.innerHTML += "<option value=" + shell + ">" + shell + "</option>";
				}
			}
			onChangeShell(shellID);
		}
		function onChangeShell(shellID){
			var id = parseInt(shellID.slice(-1));
			shellValue[id] = $('#' + shellID)[0].value;
			generateShellType("shellType" + id);
		}

		function generateShellType(shellTypeID){
			var id = parseInt(shellTypeID.slice(-1));
			selector = $('#' + shellTypeID)[0];
			selector.innerHTML = '';
			for(let shellType in typeData[id][shipValue[id]][shellValue[id]]){
				selector.innerHTML += "<option value=" + shellType + ">" + shellType + "</option>";
			}
			onChangeShellType(shellTypeID);
		}

		function onChangeShellType(shellTypeID){
			var id = parseInt(shellTypeID.slice(-1));
			shellType[id] = $('#' + shellTypeID)[0].value;
			if(autoApply[id]){
				onSubmitPredefined(id);
			}
		}
		
		const changeEvent = new Event('change');

		function changeFormValue(elementID, newValue){
			var event = new Event('change');
			let element = $(elementID)[0];
			if(newValue != element.value){
				element.value = newValue;
				element.dispatchEvent(changeEvent);
			}
		}

		function onSubmitPredefined(id){
			var targetShell = typeData[id][shipValue[id]][shellValue[id]][shellType[id]];
			changeFormValue("#shipName"  + id, shipValue[id] + " " + shellValue[id].slice(-1));
			changeFormValue("#mv"        + id, targetShell["bulletSpeed"]);
			changeFormValue("#caliber"   + id, targetShell["bulletDiametr"]);
			changeFormValue("#krupp"     + id, targetShell["bulletKrupp"]);
			changeFormValue("#mass"      + id, targetShell["bulletMass"]);
			changeFormValue("#cD"        + id, targetShell["bulletAirDrag"]);
			changeFormValue("#threshold" + id, targetShell["bulletDetonatorThreshold"]);
			changeFormValue("#fusetime"  + id, targetShell["bulletDetonator"]);
			changeFormValue("#ra0_"      + id, targetShell["bulletRicochetAt"]);
			changeFormValue("#ra1_"      + id, targetShell["bulletAlwaysRicochetAt"]);
			changeFormValue("#normal"    + id, targetShell['bulletCapNormalizeMaxAngle']);
			var HESAPv = 0;
			if(shellType[id] == 'AP'){
				HESAPv = 0;
			}else if(shellType[id] == 'HE'){
				HESAPv = targetShell["alphaPiercingHE"];
			}else if(shellType[id] == 'CS'){
				HESAPv = targetShell["alphaPiercingCS"];
			}
			changeFormValue("#HESAP"     + id, HESAPv);
		}

		//Graphs

		var v_angles = [];
		var numAngles = 8;

		function getFloatValues(elementId){return parseFloat($('#' + elementId)[0].value);}
		function getIntValues(elementId){return parseInt($('#' + elementId)[0].value);}

		var impactCharts = []
		var angleCharts = []
		var postCharts = []

		function collectMake(){
			makeGraphs(inputData);
		}

		var shellInstance;
		var impactSize;
		var postPenSize;
		var v_angles;
		var shipName;
		var shipWidth = [];

		var xAxesDistance;

		function completed(){
			var graphId = this.chart.ctx.canvas.id;
			var url = $('#' + graphId)[0].toDataURL("image/png");
			var target = $('#' + graphId.slice(0, -1) + 'Link' + graphId.slice(-1))[0];
			target.href = url;
			target.download = this.chart.config.options.title.text + '.png';
		}

		const animationCommon = {
			onComplete: completed
		}
		
		function addCommas(value, index, values) {
			return value.toLocaleString();
		}

		var targetedArmor;
		var targetInclination;

		async function makeGraphs(data){
			var v_mv = data.mv;
			var v_caliber = data.caliber;
			var v_krupp = data.krupp;
			var v_mass = data.mass;
			var v_normal = data.normal;
			var v_cD = data.cD;
			var v_threshold = data.threshold;
			var v_fusetime = data.fusetime;
			var v_ra0 = data.ra0_;
			var v_ra1 = data.ra1_;
			var v_HESAP = data.HESAP;

			var v_armor       = data.armor;
			var v_inclination = data.inclination;
			var width         = data.width;
			v_angles      = data.angle;

			shipName = data.shipName;

			for(let k=0; k<2; k++){
				shellInstance.setValues(
					v_caliber[k], 
					v_mv[k], 
					v_cD[k], 
					v_mass[k], 
					v_krupp[k], 
					v_normal[k], 
					v_fusetime[k], 
					v_threshold[k], 
					v_ra0[k], 
					v_ra1[k],
					k
				)

			}
			
			switch(computationMethod){
				case 'AB5':
					shellInstance.calcImpactAdamsBashforth5();
				break;
				case 'RK2':
					shellInstance.calcImpactRungeKutta2();
				break;
				case 'RK4':
					shellInstance.calcImpactRungeKutta4();
				break;
				case 'FE':
					shellInstance.calcImpactForwardEuler();
				break;
			}
			
			shellInstance.calcAngles(v_armor, v_inclination);
			shellInstance.calcPostPen(v_armor, v_inclination, v_angles, true, true);

			//instance.printPostPen();
			//Values same for both shells
			impactSize = shellInstance.getImpactSize()
			postPenSize = shellInstance.getPostPenSize();
            
            var max = 0;
            if(shellInstance.getImpactPoint(impactSize - 1, Module.impactDataIndex.distance.value, 1) >
            shellInstance.getImpactPoint(impactSize - 1, Module.impactDataIndex.distance.value, 0)){
                max = 1;
            }
			
			shipWidth = [];
            for(let i=0; i<impactSize; i++){
                shipWidth.push({
					x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, max),
					y: width
                })
            }

			//For downloading graphs
			
			//https://github.com/chartjs/Chart.js/issues/2830
			//Chart.js defaults to transparent background - makes downloaded images look bad
			Chart.plugins.register({
				beforeDraw: function(chartInstance) {
					var ctx = chartInstance.chart.ctx;
					ctx.fillStyle = "white";
					ctx.fillRect(0, 0, chartInstance.chart.width, chartInstance.chart.height);
				}
			});

			xAxesDistance = [{
				scaleLabel: {
					display: true,
					labelString: "Distance from Launch (m)",
				},
				ticks:{callback: addCommas,}
			}];
			

			if(!(graphSettings['minDist'] === '')){
				xAxesDistance[0].ticks['min'] = parseFloat(graphSettings['minDist']);
			}
			if(!(graphSettings['maxDist'] === '')){
				xAxesDistance[0].ticks['max'] = parseFloat(graphSettings['maxDist']);
			}
			if(!(graphSettings['tickDist'] === '')){
				xAxesDistance[0].ticks['stepSize'] = parseFloat(graphSettings['tickDist']);
			}

			targetedArmor = 'Armor Thickness: ' + v_armor + 'mm';
			targetInclination = 'Vertical Inclination: ' + v_inclination + '°'; 
			
			makeImpactCharts();
			makeAngleCharts();
			makePostPenCharts();
		}

		async function generatePoint(ship, dType, index, angle){
			let output = []
			if(dType == 0){
				if(index != Module.impactDataIndex.impactAHD.value){
					for(let i=0; i<impactSize; i++){
						output.push(
							{
								x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
								y: shellInstance.getImpactPoint(i, index, ship),
							}
						);
					}
				}else{
					for(let i=0; i<impactSize; i++){
						output.push(
							{
								x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
								y: shellInstance.getImpactPoint(i, index, ship) * -1,
							}
						);
					}
				}
			}
			else if(dType == 1){
				for(let i=0; i<impactSize; i++){
					output.push(
						{
							x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
							y: shellInstance.getAnglePoint(i, index, ship),
						}
					);
				}
			}else if(dType == 2){
				if(index != Module.postPenDataIndex.xwf.value){
					for(let i=0; i<impactSize; i++){
						if(shellInstance.getPostPenPoint(i, Module.postPenDataIndex.xwf.value, angle, ship) < 0){
							output.push(
								{
									x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
									y: shellInstance.getPostPenPoint(i, index, angle, ship),
								}
							);
						}
					}
				}else{
					for(let i=0; i<impactSize; i++){
						var yValue = shellInstance.getPostPenPoint(i, index, angle, ship);
						if(yValue >= 0){
							output.push(
								{
									x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
									y: yValue,
								}
							);
						}
					}
				}
			}else{
				console.log('Invalid Type');
			}
			return output;
		}
		
		function createUpdateChart(chartArray, index, target, config){
			if(chartArray[index]){
				chartArray[index].type = config.type;
				chartArray[index].data = config.data;
				chartArray[index].options = config.options;
				chartArray[index].update();
			}else{
				chartArray[index] = new Chart($("#" + target), config);
			}
		}	

		function roundStringNumberWithoutTrailingZeroes (num, dp) {
			if (arguments.length != 2) throw new Error("2 arguments required");

			num = String(num);
			if (num.indexOf('e+') != -1) {
				// Can't round numbers this large because their string representation
				// contains an exponent, like 9.99e+37
				throw new Error("num too large");
			}
			if (num.indexOf('.') == -1) {
				// Nothing to do
				return num;
			}

			var parts = num.split('.'),
				beforePoint = parts[0],
				afterPoint = parts[1],
				shouldRoundUp = afterPoint[dp] >= 5,
				finalNumber;

			afterPoint = afterPoint.slice(0, dp);
			if (!shouldRoundUp) {
				finalNumber = beforePoint + '.' + afterPoint;
			} else if (/^9+$/.test(afterPoint)) {
				// If we need to round up a number like 1.9999, increment the integer
				// before the decimal point and discard the fractional part.
				finalNumber = Number(beforePoint)+1;
			} else {
				// Starting from the last digit, increment digits until we find one
				// that is not 9, then stop
				var i = dp-1;
				while (true) {
					if (afterPoint[i] == '9') {
						afterPoint = afterPoint.substr(0, i) +
									'0' +
									afterPoint.substr(i+1);
						i--;
					} else {
						afterPoint = afterPoint.substr(0, i) +
									(Number(afterPoint[i]) + 1) +
									afterPoint.substr(i+1);
						break;
					}
				}

				finalNumber = beforePoint + '.' + afterPoint;
			}

			// Remove trailing zeroes from fractional part before returning
			return finalNumber.replace(/0+$/, '')
		}

		function addTooltipCallbackImpact(config, ...labels){
			config.options['tooltips'] = {
				enabled: true,
				callbacks: {},
			};
			if(!(graphSettings['rounding'] === '' || graphSettings['rounding'] === '0')){
				var decimalPlaces = parseInt(graphSettings['rounding']);
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						var x = roundStringNumberWithoutTrailingZeroes(
							tooltipItems.label, decimalPlaces);
						var y = roundStringNumberWithoutTrailingZeroes(
							tooltipItems.value, decimalPlaces);
						if(tooltipItems.datasetIndex % 2 == 0){
							return labels[0](x, y);
						}else{
							return labels[1](x, y);
						}
					}
				};
			}else{
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						var x = tooltipItems.label;
						var y = tooltipItems.value;
						if(tooltipItems.datasetIndex % 2 == 0){
							return labels[0](x, y);
						}else{
							return labels[1](x, y);
						}
					}
				};
			}
		}
		function penetrationToolTipLabel(x, y){
			return '(' + x + 'm, ' + y + 'mm)';
		}
		function angleTooltipLabel(x, y){
			return '(' + x + 'm, ' + y + '°)';
		}
		function velocityTooltipLabel(x, y){
			return '(' + x + 'm, ' + y + 'm/s)';
		}
		function timeTooltipLabel(x, y){
			return '(' + x + 'm, ' + y + 's)';
		}

		function filterLegend(item, chart){
			return !(item.text == '_remove_');
		}

		const commonPointRadius = 0;
		var graphShip = [true, true];
		var colors = [
			["#3e95cd", "#FFA500", "#FFD700"],
			["#008000", "#FF0000", "#FF0090"],
		]

		async function makeImpactCharts(){ //Set Impact
			const points = [
				[0, 0, Module.impactDataIndex.ePenHN.value   , 0],
				[0, 0, Module.impactDataIndex.impactAHD.value, 0],
				[1, 0, Module.impactDataIndex.ePenHN.value   , 0],
				[1, 0, Module.impactDataIndex.impactAHD.value, 0],

				[0, 0, Module.impactDataIndex.ePenDN.value   , 0],
				[0, 0, Module.impactDataIndex.impactADD.value, 0],
				[1, 0, Module.impactDataIndex.ePenDN.value   , 0],
				[1, 0, Module.impactDataIndex.impactADD.value, 0],

				[0, 0, Module.impactDataIndex.impactV.value  , 0],
				[0, 0, Module.impactDataIndex.tToTargetA.value, 0],
				[1, 0, Module.impactDataIndex.impactV.value  , 0],
				[1, 0, Module.impactDataIndex.tToTargetA.value, 0],
			]

			const tasks = points.map(
				function(input){
					return generatePoint(input[0], input[1], input[2], input[3]);
				}
			)
			const results = await Promise.all(tasks);
			//console.log(results)
			const yAxesPenetration = {
				id: "Penetration", postition: "left",
				scaleLabel: {
					display: true,
				},
				ticks: {
					stepSize: 100,
					callback: addCommas,
				}
			}

			const yAxesRightAngle = {
				id: "Angle", position: "right",
				scaleLabel: {
					display: true,
				},
			}

			var hRAL = yAxesRightAngle;
			hRAL.scaleLabel['labelString'] = "Belt Impact Angle (°)";
			var hRPL = yAxesPenetration;
			hRPL.scaleLabel['labelString'] = "Belt Penetration (mm)";

			const  EPL = "Effective Penetration ";
			const IAL = "Impact Angle ";
			var configPC0 = {
				type: 'scatter', data: {datasets: []},
				options: {
					elements: {
						line: {
						cubicInterpolationMode: 'default' 
						}
					},
					title: {
						display: true,
						text: 'Horizontal Penetration and Impact Angle'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [hRPL , hRAL,]
					},
					animation: animationCommon,
				}
			}
			addTooltipCallbackImpact(configPC0, penetrationToolTipLabel, angleTooltipLabel);
			graphShip.map(function callback(currentValue, index){
				if(currentValue){
					configPC0.data.datasets.push(
						{
							data: results[index* 2], showLine: true, 
							label: EPL + shipName[index], 
							yAxisID: "Penetration",
							borderColor: colors[index][0], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index * 2 + 1], showLine: true,
							label: IAL + shipName[index], 
							yAxisID: "Angle",
							borderColor: colors[index][1], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},
					)
				}
			});
			createUpdateChart(impactCharts, 0, "penChart0", configPC0);

			var vRAL = yAxesRightAngle;
			vRAL.scaleLabel['labelString'] = "Deck Impact Angle (°)";
			var vRPL = yAxesPenetration;
			vRPL.scaleLabel['labelString'] = "Deck Penetration (mm)";
			
			const EDP = "Effective Deck Penetration ";
			const DIA = "Deck Impact Angle ";
			var configPC1 = {
				type: 'scatter', data: {datasets: []},
				options: {
					title: {
						display: true,
						text: 'Deck Penetration and Impact Angle'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [vRPL, vRAL,]
					},
					animation: animationCommon,
				}
			};
			addTooltipCallbackImpact(configPC1, penetrationToolTipLabel, angleTooltipLabel);
			graphShip.map(function callback(currentValue, index){
				if(currentValue){
					configPC1.data.datasets.push(
						{
							data: results[index*2+4], showLine: true,
							label: EDP + shipName[index],
							yAxisID: "Penetration",
							borderColor: colors[index][0], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*2+5], showLine: true,
							label: DIA + shipName[index], 
							yAxisID: "Angle",
							borderColor: colors[index][1], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},
					)
				}
			});
			createUpdateChart(impactCharts, 1, "penChart1", configPC1);

			const IVL = "Impact Velocity ";
			const FTL = "Flight Time ";
			//impactCharts[2] = new Chart($("#penChart2"), 
			var configPC2 = {
				type: 'scatter', data: {datasets: []},
				options: {
					title: {
						display: true,
						text: 'Shell Flight Time and Impact Velocity'
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "Impact Velocity", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Impact Velocity (m/s)",
							},
							ticks: {
								stepSize: 100
							}
						},{
							id: "Time", position: "right",
							scaleLabel: {
								display: true,
								labelString: "Flight Time (s)",
							},
						}
						]
					},
					animation: animationCommon,
				}

			};
			addTooltipCallbackImpact(configPC2, velocityTooltipLabel, timeTooltipLabel);
			graphShip.map(function callback(currentValue, index){
				if(currentValue){
					configPC2.data.datasets.push(
						{
							data: results[index*2+8], showLine: true,
							label: IVL + shipName[index], 
							yAxisID: "Impact Velocity",
							borderColor: colors[index][0], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*2+9], showLine: true,
							label: FTL + shipName[index], 
							yAxisID: "Time",
							borderColor: colors[index][1], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},
					)
				}
			});
			createUpdateChart(impactCharts, 2, "penChart2", configPC2);
		}

		function addTooltipCallbackAngles(config){
			config.options['tooltips'] = {
				enabled: true, callbacks: {}
			}
			if(!(graphSettings['rounding'] === '' || graphSettings['rounding'] === '0')){
				var decimalPlaces = parseInt(graphSettings['rounding']);
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						return angleTooltipLabel(
							roundStringNumberWithoutTrailingZeroes(tooltipItems.label, decimalPlaces), 
							roundStringNumberWithoutTrailingZeroes(tooltipItems.value, decimalPlaces));
					}
				};
			}else{
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						return angleTooltipLabel(tooltipItems.label, tooltipItems.value);
					}
				};
			}
		}

		function generateAngleFillArmor(ship){
			var fills = [[], [], []];
			for(let i=0; i<impactSize; i++){
				var armor = shellInstance.getAnglePoint(i, Module.angleDataIndex.armorD.value, ship);
				var ra0 = shellInstance.getAnglePoint(i, Module.angleDataIndex.ra0D.value, ship);
				var ra1 = shellInstance.getAnglePoint(i, Module.angleDataIndex.ra1D.value, ship);
				if(armor > ra1){
					fills[2].push({ //Armor - ra1
						x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
						y: armor,
					});
				}
				var armorRa1 = armor < ra1 ? armor : ra1; 
				if(armorRa1 > ra0){
					fills[1].push({ //ArmorRa1 - Ra0
						x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
						y: armorRa1,
					});
				}
				var armorRa0 = armor < ra0 ? armor : ra0;
				if(true){
					fills[0].push({ //ArmorRa0 - Bottom
						x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
						y: armorRa0,
					});
				}
			}
			return fills;
		}

		function generateAngleFillFuse(ship){
			var fills = [[], [], []];
			for(let i=0; i<impactSize; i++){
				var fuse = shellInstance.getAnglePoint(i, Module.angleDataIndex.fuseD.value, ship);
				var ra0 = shellInstance.getAnglePoint(i, Module.angleDataIndex.ra0D.value, ship);
				var ra1 = shellInstance.getAnglePoint(i, Module.angleDataIndex.ra1D.value, ship);
				var fuseRa0 = fuse < ra0 ? ra0 : fuse;
				var fuseRa1 = fuse < ra1 ? ra1 : fuse;
				if(fuse < ra0){
					fills[0].push({
						x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
						y: fuse
					});
				}
				if(fuseRa0 < ra1){
					fills[1].push({
						x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
						y: fuseRa0
					});
				}
				fills[2].push({
					x: shellInstance.getImpactPoint(i, Module.impactDataIndex.distance.value, ship),
					y: fuseRa1
				});
			}
			return fills;
		}

		async function makeAngleCharts(){//Set Angle Charts
			const points = [
				[0, 1, Module.angleDataIndex.armorD.value, 0],
				[0, 1, Module.angleDataIndex.ra0D.value  , 0],
				[0, 1, Module.angleDataIndex.ra1D.value  , 0],

				[1, 1, Module.angleDataIndex.armorD.value, 0],
				[1, 1, Module.angleDataIndex.ra0D.value  , 0],
				[1, 1, Module.angleDataIndex.ra1D.value  , 0],

				[0, 1, Module.angleDataIndex.fuseD.value , 0],
				[1, 1, Module.angleDataIndex.fuseD.value , 0],
			]

			const tasks = points.map(
				function(input){
					return generatePoint(input[0], input[1], input[2], input[3]);
				}
			)
			const results = await Promise.all(tasks);

			const armorL = "Maximum Perforation Angle ";
			const ra0L = "Start Ricochet "
			const ra1L = "Always Ricochet "
			//var FTL = " ";
			//angleCharts[0] = new Chart($("#angleChart0"), 
			var configAC0 = {
				type: 'scatter', data: {datasets: []},
				options: {
					title: {
						display: true,
						text: 'Maximum Angle for Perforation | ' + targetedArmor + ' | ' + targetInclination
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "angle", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Lateral Angle (°)",
							},
							ticks:{min: 0}
						}]
					},
					legend: {labels: {filter: filterLegend},},
					animation: animationCommon,
				}
			};
			addTooltipCallbackAngles(configAC0);
			graphShip.map(function callback(currentValue, index){
				if(currentValue){
					configAC0.data.datasets.push({
							data: results[index*3+0], showLine: true,
							label: armorL + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][0]),
							borderColor: colors[index][0], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*3+1], showLine: true, borderDash: [5, 5],
							label: ra0L + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][1]),
							borderColor: colors[index][1], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*3+2], showLine: true, borderDash: [5, 5],
							label: ra1L + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][2]),
							borderColor: colors[index][2], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},
					);
					if(graphSettings['enableFills']){
						var fills = generateAngleFillArmor(index);
						configAC0.data.datasets.push(
							{
								data: fills[2], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][0]),
								borderColor: colors[index][0], fill: '-1', pointRadius: 0, pointHitRadius: 0
							},{
								data: fills[1], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][2]),
								borderColor: colors[index][2], fill: '-3', pointRadius: 0, pointHitRadius: 0
							},{
								data: fills[0], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][1]),
								borderColor: colors[index][1], fill: true, pointRadius: 0, pointHitRadius: 0
							},
						);
					}
				}
			});
			createUpdateChart(angleCharts, 0, "angleChart0", configAC0);
			const fuseL = "Minimum Fusing Angle ";
			var configAC1 = {
				type: 'scatter', data: {datasets: []},
				options: {
					title: {
						display: true,
						text: 'Minimum Fusing Angle | ' + targetedArmor + ' | ' + targetInclination
					},
					scales: {
						xAxes: xAxesDistance,
						yAxes: [{
							id: "angle", postition: "left",
							scaleLabel: {
								display: true,
								labelString: "Lateral Angle (°)",
							},
							ticks:{min: 0}
						}]
					},
					legend: {labels: {filter: filterLegend},},
					animation: animationCommon,
				}
			};
			addTooltipCallbackAngles(configAC1);
			graphShip.map(function callback(currentValue, index){
				if(currentValue){
					configAC1.data.datasets.push(
						{
							data: results[index+6], showLine: true,
							label: fuseL + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][0]),
							borderColor: colors[index][0], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*3+1], showLine: true, borderDash: [5, 5],
							label: ra0L + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][1]),
							borderColor: colors[index][1], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},{
							data: results[index*3+2], showLine: true, borderDash: [5, 5],
							label: ra1L + shipName[index], 
							yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][2]),
							borderColor: colors[index][2], fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						},
					);
					if(graphSettings.enableFills){
						var fills = generateAngleFillFuse(index);
						configAC1.data.datasets.push(
							{
								data: fills[0], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][2]),
								borderColor: colors[index][2], fill: '-2', pointRadius: 0, pointHitRadius: 0
							},{
								data: fills[1], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][1]),
								borderColor: colors[index][1], fill: '-2', pointRadius: 0, pointHitRadius: 0
							},{
								data: fills[2], showLine: true, borderWidth: 0,
								label: '_remove_', 
								yAxisID: "angle", backgroundColor: Samples.utils.transparentize(colors[index][0]),
								borderColor: colors[index][0], fill: 'end', pointRadius: 0, pointHitRadius: 0
							},
						);
					}
				}
			});
			createUpdateChart(angleCharts, 1, "angleChart1", configAC1);
		}

		function addTooltipCallbackPostPen(config){
			config.options['tooltips'] = {enabled: true, callbacks: {}}
			if(!(graphSettings['rounding'] === '' || graphSettings['rounding'] === '0')){
				var decimalPlaces = parseInt(graphSettings['rounding']);
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						return postPenToolTipLabels(
							roundStringNumberWithoutTrailingZeroes(tooltipItems.label, decimalPlaces), 
							roundStringNumberWithoutTrailingZeroes(tooltipItems.value, decimalPlaces));
					}
				};
			}else{
				config.options.tooltips.callbacks = {
					label: function(tooltipItems, data) { 
						return postPenToolTipLabels(tooltipItems.label, tooltipItems.value);
					}
				};
			}
		}
		function postPenToolTipLabels(x, y){
			return '(' + x + ' m, ' + y + ' m)';
		}
		async function makePostPenCharts(){ //Set PostPen
			const width = $('#width').value;
			const WFL = "Fused ", NFL = "No Fusing ";
			var configs = [];
			for(let i=0; i<numAngles; i++){
				var str = "Lateral Angle " + i + ": " + v_angles[i] + "°";
				$("#AT" + i)[0].textContent = str;

				const points = [
					[0, 2, Module.postPenDataIndex.xwf.value, i],
					[0, 2, Module.postPenDataIndex.x.value  , i],
					[1, 2, Module.postPenDataIndex.xwf.value, i],
					[1, 2, Module.postPenDataIndex.x.value  , i],
				]

				const tasks = points.map(
					function(input){return generatePoint(input[0], input[1], input[2], input[3]);}
				)
				const results = await Promise.all(tasks);

				configs[i] = {
					type: 'scatter',
					data: {
						datasets: [{
								data: shipWidth, showLine: true, borderDash: [5, 5],
								label: "Ship Width (m)", //backgroundColor: Samples.utils.transparentize("#505050"),
								borderColor: "#505050", fill: false, pointRadius: commonPointRadius, pointHitRadius: 5
						}]
					},
					options: {
						title: {
							display: true,
							text: 'Internal Width Traveled before Detonation | ' + targetedArmor + ' | ' + targetInclination + ' | Horizontal Impact Angle: ' + v_angles[i] + "°"
						},
						scales: {
							xAxes: xAxesDistance,
							yAxes: [{
								scaleLabel: {
									display: true,
									labelString: "Shell Detonation Distance (m)",
								},
							}]
						},
						animation: animationCommon,
					}
				};
				addTooltipCallbackPostPen(configs[i]);
				graphShip.map(function callback(currentValue, index){
					if(currentValue){
						configs[i].data.datasets.push(
							{
								data: results[2*index+0], showLine: true,
								label: WFL + shipName[index], backgroundColor: Samples.utils.transparentize(colors[index][0]),
								borderColor: colors[index][0], fill: true, pointRadius: commonPointRadius, pointHitRadius: 5
							},{
								data: results[2*index+1], showLine: true,
								label: NFL + shipName[index], backgroundColor: Samples.utils.transparentize(colors[index][1]),
								borderColor: colors[index][1], fill: true, pointRadius: commonPointRadius, pointHitRadius: 5
							},
						);
					}
				});

				createUpdateChart(postCharts, i, "postPen" + i, configs[i]);
			}
		}
    </script>
	<p>If you find a bug or want a new feature, please <a href="https://github.com/jcw780/wows_ballistics/issues">open an issue</a> at GitHub. Your suggestions will be considered at later development.</p>
	</body>
</html>